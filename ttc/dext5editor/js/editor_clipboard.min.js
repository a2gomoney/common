const accessNavigatorClipboard=d=>new Promise(async(b,a)=>{a=await getNavigatorClipboard();if(null!=a.error)b(a);else try{if(a.clipboardData){let k=new DataTransfer,g=new ClipboardEvent("paste",{clipboardData:k}),l=a.clipboardData.types;var e=!0===(d?d:{}).pasteText;for(let c of l)if(!e||"text/plain"==c)if("text/plain"==c||"text/html"==c){let f=await a.clipboardData.getType(c),h=await (new Response(f)).text();g.clipboardData.setData(c,h)}else if("image/png"==c){let f=await a.clipboardData.getType(c),
h=new File([f],"paste.png",{type:"image/png"});g.clipboardData.items.add(h)}_iframeDoc.body.dispatchEvent(g)}}catch(k){result.error=4,b(result)}}),checkImageInNavigatorClipboard=()=>new Promise(async(d,b)=>{let a={error:null,checked:!1},e=await getNavigatorClipboard();if(null!=e.error)d(e);else try{if(e.clipboardData){const g=e.clipboardData.types;let l=b=!1;for(let c of g)"image/png"===c?a.checked=!0:"text/html"===c?b=!0:"text/plain"===c&&(l=!0);if("1"===_dext_editor._config.pasteToImageConvertHtmlToImage)if(!1===
a.checked&&b){let c=await e.clipboardData.getType("text/html");var k={strData:await c.text(),goDownload:!1,sizeFitToContents:!0};clipboardHtmlToImage(k,async f=>{f={"image/png":f,"text/html":c};if(l){var h=await e.clipboardData.getType("text/plain");f["text/plain"]=h}try{const m=new ClipboardItem(f);await navigator.clipboard.write([m]);a.checked=!0}catch(m){a.checked=!1}d(a)})}else d(a);else d(a)}}catch(g){a.error=3,d(a)}}),getNavigatorClipboard=()=>new Promise(async(d,b)=>{b={error:null,clipboardData:null};
try{if("denied"==(await DEXTTOP.navigator.permissions.query({name:"clipboard-read",allowWithoutGesture:!1})).state){b.error=2;d(b);return}}catch(a){b.error=1,d(b)}try{let a=await DEXTTOP.navigator.clipboard.read();a[0]&&(b.clipboardData=a[0],d(b))}catch(a){d(b)}});
