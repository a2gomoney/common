function makeWorker(d,g){if("script"==d)try{var a=new Blob([g]);worker=new Worker(URL.createObjectURL(a));URL.revokeObjectURL(a)}catch(c){worker=new Worker(g)}else worker=new Worker(g);return worker}var FileReaderSyncSupport=!1,syncDetectionScript="onmessage = function(e) { postMessage(!!FileReaderSync); };",fileOpenWorker;checkFileReaderSyncSupport();var releaseWorker=function(){fileOpenWorker.terminate()};
function checkFileReaderSyncSupport(){if(fileOpenWorker=makeWorker("url",Dext5LayerWin._dext_editor._config.fileEncodingWorkerJSUrl+"?t="+DEXTTOP.DEXT5.UrlStamp))fileOpenWorker.onmessage=function(d){FileReaderSyncSupport=d.data.result;releaseWorker()},fileOpenWorker.postMessage({init:!0})}
function processFiles(d,g){if(FileReaderSyncSupport){var a=makeWorker("url",Dext5LayerWin._dext_editor._config.fileEncodingWorkerJSUrl+"?t="+DEXTTOP.DEXT5.UrlStamp);a&&(a.onmessage=function(a){g(a.data.hasBom,a.data.result)},Array.prototype.forEach.call(d,function(c){a.postMessage(c)}))}}
function handleFileSelect(d){FileReaderSyncSupport&&processFiles(d,function(d,a){if(0==a.indexOf("[DEXT5Error]")){try{var c={strType:"FileOpen",strCode:"C210",strMessage:a};if("function"===typeof DEXTTOP.G_CURREDITOR._config.event.onError)DEXTTOP.G_CURREDITOR._config.event.onError(DEXTTOP.G_CURREDITOR.ID,c);else"function"===typeof DEXTTOP.DEXTWIN.dext_editor_on_error_event?DEXTTOP.DEXTWIN.dext_editor_on_error_event(DEXTTOP.G_CURREDITOR.ID,c):alert(c.strMessage)}catch(h){alert(a)}event_dext_open_file_upload_completed("")}else{var b=
a.toLowerCase(),f,e,c=b.indexOf("<!doctype");f=b.indexOf("<html");e=b.indexOf("<head");0>e&&(e=b.indexOf("<meta"));0>e&&(e=b.indexOf("<title"));b=b.indexOf("<body");-1<c&&c<f&&f<b?a=a.substring(c):-1<f&&f<b?a=a.substring(f):-1<e&&e<b?a=a.substring(e):-1<b&&(a=a.substring(b));event_dext_open_file_upload_completed(a)}releaseWorker()})};
